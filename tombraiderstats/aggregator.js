// 2015-08-16
var ljacqu={};ljacqu.config=function(){var t=["enemy","item","hazard","secret","gold","silver","friendly","crystal"],e={"cat mummies":"cat mummy",enemies:"enemy","guard dog":"dog",gunmen:"gunman","hk ammo":"hk clips",huskies:"dog",husky:"dog","large medipak":"large medipack",men:"man",mercenaries:"mercenary","mp5 ammo":"mp5 clips",mummies:"mummy","shotgun ammo":"shotgun shells","small medipak":"small medipack","smg ammo":"smg clips",switches:"switch",tribesmen:"tribesman","wild boar":"boar","wolf's":"wolf",wolves:"wolf"},n=100,a=function(t){return"span."+t};return{classesToAggregate:t,maximumEntryLength:n,plurals:e,selectEntities:a}}(),ljacqu.status={},ljacqu.total={},ljacqu.loadJquery=function(t){var e=0,n=function(){return e++,"undefined"!=typeof jQuery?void t():void(100>e?setTimeout(n,100):console.error("Could not load jQuery!"))};if("undefined"==typeof jQuery){delete $;var a=document.createElement("script");a.src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.3/jquery.min.js",document.getElementsByTagName("head")[0].appendChild(a),n()}else t()},ljacqu.game=function(){var t=function(){var t=/\/stella\/([a-z0-9\-_]+)\.html/i,e=/\/stella\/walks\/([a-z0-9\-_]+)\/.*?\.html/i,n=window.location.href,a=n.match(t);if(null!==a)return["overview",a[1]];if(a=n.match(e),null!==a)return["single",a[1]];throw ljacqu.display.displayError("Please make sure you are on a walkthrough or overview page!"),new Error("Did not recognize URL")},e=function(t){var e=$('h2:contains("Walkthrough")').next("div");e.prepend($('<table id="agg_options">')),$("#agg_options").append('<tr><td colspan="3">Please click on the OS  to get the walkthroughs for. <span class="em4" id="agg_click_msg">Click to select</span></td></tr>'),$("#agg_click_msg").hide(),$("#agg_options").append($("<tr>"));for(var n=0;n<t.length;n++){$("#agg_options tr:last").append('<td><span class="em5" style="font-weight: bold" title="Click to select">'+t[n]+"</span></td>");var a=$("#agg_options tr:last td:eq("+n+")");a.on("click",function(e){return function(){ljacqu.status.optionOs=t[e],$("#agg_options").remove(),ljacqu.run.overviewPageRunner()}}(n)),a.hover(function(){$(this).find("span").attr("class","em3"),$("#agg_click_msg").show()},function(){$(this).find("span").attr("class","em5"),$("#agg_click_msg").hide()})}},n=function(){var t=ljacqu.status.optionOs,e=$('[class^="walk-table"] a[href^="walks/"]').filter(':contains("'+t+'")');return $.each(e,function(t){var n=$(this).closest("p").text().match(/^(.*?)\(/);e[t].text=n[1].trim()}),e},a=function(){return"tomb4"===ljacqu.status.game?$('[class^="walk-table"] a[href^="walks/"]').filter(':not(:contains("Cairo  Overview"))'):"tomb7"===ljacqu.status.game?$('a:contains("Croft Manor"), [class^="walk-table"] a[href^="walks/"]').filter(':not(:contains("Time Trial Tips"))'):"tomb8"===ljacqu.status.game?"undefined"==typeof ljacqu.status.optionOs?(e(["PC/Mac/PS3/Xbox 360","Wii","PS2"]),!1):n():"tomb9"===ljacqu.status.game?$('[class^="walk-table"] a[href^="walks/"]').filter(':contains("Area"), :contains("Shantytown")'):$('[class^="walk-table"] a[href^="walks/"]')};return{detectModeAndGame:t,getWalkthroughLinks:a}}(),ljacqu.text=function(){var t=function(t){return t.match(/^secret #\d+$/i)?"secret":t.replace(/^\W+/,"").replace(/\W+$/,"").trim().toLowerCase()},e=function(e){if(e=t(e),""===e)return{name:"",number:0};var n=e.match(/^(\d+) (.*)$/);if(n)return{number:parseInt(n[1]),name:n[2]};var a=["one","two","three","four","five","six"],r=new RegExp("^("+a.join("|")+")\\s(.*?)$"),i=e.match(r);return i?(a.unshift(0),{name:i[2],number:a.indexOf(i[1])}):{name:e,number:1}},n=function(t,e){if(t=t.toLowerCase(),"undefined"!=typeof ljacqu.config.plurals[t])return ljacqu.config.plurals[t];if("s"===t.substr(t.length-1)){var n=t.substr(0,t.length-1);if("undefined"!=typeof e[n])return n}return t},a=function(){var t=["first","second","third","fourth","fifth","sixth","seventh","eighth","ninth","tenth"],e=["the","a"],n=["more","additional","another","other","sets of","boxes of","bunches of","bundles of","bundle of"],a=function(t){return"("+t.join("\\s|")+"\\s)"};return new RegExp("^("+a(n)+"|"+a(e)+"?"+a(t)+"?)?(.*?)$","i")},r=function(t,e){var r=t.match(a()),i=r?r[r.length-1]:t;return i=n(i,e),i!==t&&(console.log(t+" renamed to "+i),"undefined"!=typeof e[i]?e[i]+=e[t]:e[i]=e[t],delete e[t]),e},i=function(t){var e=t;for(var n in t)t.hasOwnProperty(n)&&(e=r(n,e));return e},o=function(t,e){for(var n in t)t.hasOwnProperty(n)&&("undefined"!=typeof ljacqu.total[e][n]?ljacqu.total[e][n]+=t[n]:ljacqu.total[e][n]=t[n])},s=function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push([n,t[n]]);return e.sort(function(t,e){var n=e[1]-t[1];return 0!==n?n:t[0]>e[0]?1:t[0]<e[0]?-1:0}),e},l=function(t,n){n=n||document;var a={};$.each($(ljacqu.config.selectEntities(t),n),function(){var t=e($(this).text());""!==t.name&&("undefined"==typeof a[t.name]?a[t.name]=t.number:a[t.name]+=t.number)});var r=i(i(a));return"overview"===ljacqu.status.mode&&o(r,t),s(r)};return{createdSortedPairArray:s,fetchEntities:l}}(),ljacqu.container=function(){var t=function(){var t=$("overview"===ljacqu.status.mode?"#wrap":"#LayoutDiv1");if(0===t.length){if("TR9walk"===ljacqu.status.game)return $(".gridContainer").prepend($('<div id="LayoutDiv1">')),$("#LayoutDiv1");throw new Error("Could not get base element!")}return t},e=function(t){var e=t.split("/");return"ctr_"+e[e.length-1].split(".")[0]},n=function(n){var a=e(n.url);if(0!==$("#"+a).length)return $("#"+a);t().before('<div id="'+a+'"><h1>'+n.text+"</h1></div>");var r=$("#"+a);return $("#"+a).find("h1").click(function(){r.find("div:visible").length>0?r.find("div").hide():r.find("div").show()}),r},a=function(t){var a=e(t.url),r=$("#"+a);return 0===r.length&&(r=n(t)),r},r=function(t){return"sec_"+t},i=function(t,e,n){var r=a(e),i="overview"===ljacqu.status.mode&&"_total"!==e.url?' style="display: none"':"";r.append('<div class="'+t+'"'+i+"><h2>"+n+"</h2><table></table></div>");var o=r.find("."+t);return o.find("h2").click(function(){o.find("table").toggle()}),o},o=function(t,e){e=e||{url:"results",text:"Statistics"};var n=a(e),o=r(t),s=n.find("."+o);if(0===s.length){var l=t.charAt(0).toUpperCase()+t.substr(1);s=i(o,e,l)}return s},s=function(t){$('div[id^="ctr"] div.sec_'+t).remove()},l=function(){t().prevAll("div").remove()};return{createContainer:n,getContainer:a,getSection:o,removeAllSections:s,removeAll:l}}(),ljacqu.display=function(){var t=function(t,e){return t.length>e?t.substr(0,e).trim()+"...":t},e=function(e,n){for(var a=0,r=0;r<n.length;++r)a+=n[r][1],e.append($("<tr>").append("<td>"+t(n[r][0],ljacqu.config.maximumEntryLength)+'</td><td style="text-align: right">'+n[r][1]+"</td>"));n.length>=2&&e.append('<tr class="agg_total"><td>Total</td><td style="text-align: right">'+a+"</td></tr>")},n=function(t,e){if("single"===ljacqu.status.mode){var n=2===t.find("tr").length?"tr":"tr:not(:last-child)";t.find(n).find("td:first").attr("class",e)}else{var a="width: auto";("undefined"==typeof t.attr("style")||-1===t.attr("style").indexOf(a))&&t.attr("style",a),t.find("tr:even").attr("style","background:#343434;color:#BCBCBC"),t.find("tr.agg_total").find("td").attr("style","border-top: 1px solid #ccc")}},a=function(t,a,r){var i=ljacqu.container.getSection(a,r),o=i.find("table");o.html("<tr><th>Type</th><th>Total</th></tr>"),t.length>0?(e(o,t),n(o,a),ljacqu.status.classes[a]=!0):o.html("<tr><td>No entities found.</td></tr>")},r=function(){for(var t=0;t<ljacqu.config.classesToAggregate.length;t++){var e=ljacqu.config.classesToAggregate[t];"undefined"==typeof ljacqu.status.classes[e]&&ljacqu.container.removeAllSections(e)}},i=function(){var t={url:"_total",text:"Total"};ljacqu.container.createContainer(t);for(var e in ljacqu.total)ljacqu.total.hasOwnProperty(e)&&a(ljacqu.text.createdSortedPairArray(ljacqu.total[e]),e,t)},o=function(){"single"===ljacqu.status.mode?r():ljacqu.status.handledLinks===ljacqu.status.foundLinks&&(i(),r())},s=function(t){var e=$("#agg_err");0===e.length&&($("body").prepend('<div id="agg_err" style="color:#300; display:block; border:1px solid #900; background-color:#fee; padding:10px; margin:20px; z-index:2015; opacity:1"></div>'),e=$("#agg_err")),e.hide(),$("html, body").animate({scrollTop:0},"slow"),e.html(t),e.fadeIn()};return{displayEntities:a,displayError:s,postProcess:o}}(),ljacqu.run=function(){var t=function(t,e){for(var n=0;n<ljacqu.config.classesToAggregate.length;++n){var a=ljacqu.config.classesToAggregate[n],r=ljacqu.text.fetchEntities(a,t);ljacqu.display.displayEntities(r,a,e)}ljacqu.status.handledLinks++,ljacqu.display.postProcess()},e=function(){var t=ljacqu.game.detectModeAndGame();ljacqu.status={mode:t[0],game:t[1],classes:{},foundLinks:0,handledLinks:0},ljacqu.total={};for(var e=ljacqu.config.classesToAggregate,n=0;n<e.length;++n)ljacqu.total[e[n]]={}},n=function(t){var e=t.attr("href").split("#")[0];return{url:e,text:t.text().replace(/\s{2,}/g," ")}},a=function(t){var e=ljacqu.container.getContainer(t).find("h1");-1===e.text().indexOf(t.text)&&e.append('<span style="font-size: 0.8em"> + '+t.text+"</span>")},r=function(){var e=ljacqu.game.getWalkthroughLinks();if("boolean"!=typeof e){ljacqu.status.foundLinks=e.length;var r={};$.each(e,function(){var e=n($(this));return"undefined"!=typeof r[e.url]?(a(e),ljacqu.status.handledLinks++,void ljacqu.display.postProcess()):(ljacqu.container.createContainer(e),r[e.url]=!0,void $.get(e.url,{},function(n){t(n.replace(/<img/g,"<cheese"),e)},"html"))})}},i=function(){var t=/^https?:\/\/(www\.)?tombraiders\.net(\/.*)?$/i.test(window.location.href);return t||ljacqu.display.displayError('You are not on <b><a href="http://tombraiders.net">tombraiders.net</a></b>'),t};return{initStatus:e,processPage:t,overviewPageRunner:r,checkWebsite:i}}(),ljacqu.loadJquery(function(){ljacqu.run.checkWebsite()&&(ljacqu.run.initStatus(),"overview"===ljacqu.status.mode?ljacqu.run.overviewPageRunner():ljacqu.run.processPage())});